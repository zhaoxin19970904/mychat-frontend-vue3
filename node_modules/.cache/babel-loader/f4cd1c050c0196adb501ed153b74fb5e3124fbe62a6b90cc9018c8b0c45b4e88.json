{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = /*#__PURE__*/_createElementVNode(\"h1\", null, \"Welcome Chat\", -1 /* HOISTED */);\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_a_form = _resolveComponent(\"a-form\");\n  const _component_GoogleLogin = _resolveComponent(\"GoogleLogin\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_hoisted_1, _createVNode(_component_a_form, {\n    model: $setup.formState,\n    name: \"basic\",\n    \"label-col\": {\n      span: 8\n    },\n    \"wrapper-col\": {\n      span: 16\n    },\n    autocomplete: \"off\",\n    onFinish: $setup.onFinish,\n    onFinishFailed: _ctx.onFinishFailed\n  }, {\n    default: _withCtx(() => [_createCommentVNode(\" 输入表单项省略，与原代码相同 \")]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\", \"onFinishFailed\"]), _createElementVNode(\"div\", null, [_createVNode(_component_GoogleLogin, {\n    callback: $setup.callback\n  })])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementVNode","_createElementBlock","_Fragment","_hoisted_1","_createVNode","_component_a_form","model","$setup","formState","name","span","autocomplete","onFinish","onFinishFailed","_ctx","default","_withCtx","_createCommentVNode","_","_component_GoogleLogin","callback"],"sources":["C:\\Users\\bobxi\\OneDrive\\Desktop\\Ecloud\\tut8\\my-vue-app\\src\\components\\loginForm.vue"],"sourcesContent":["<template>\r\n  <h1>Welcome Chat</h1>\r\n  <a-form\r\n    :model=\"formState\"\r\n    name=\"basic\"\r\n    :label-col=\"{ span: 8 }\"\r\n    :wrapper-col=\"{ span: 16 }\"\r\n    autocomplete=\"off\"\r\n    @finish=\"onFinish\"\r\n    @finishFailed=\"onFinishFailed\"\r\n  >\r\n    <!-- 输入表单项省略，与原代码相同 -->\r\n  </a-form>\r\n  <div>\r\n    <GoogleLogin :callback=\"callback\"/>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref } from 'vue';\r\nimport axios from 'axios';\r\nimport { useRouter } from 'vue-router';\r\nimport {jwtDecode} from 'jwt-decode';\r\n\r\nconst router = useRouter();\r\nconst formState = reactive({\r\n  username: '',\r\n  password: '',\r\n  remember: true,\r\n});\r\nconst isLoading = ref(false); // 新增：加载状态\r\n\r\nconst onFinish = async values => {\r\n  isLoading.value = true; // 登录开始，显示加载状态\r\n  try {\r\n    const response = await axios.post('http://localhost:8000/submit', values);\r\n    const token = response.data.token;\r\n    console.log(token);\r\n    localStorage.setItem('token', token);\r\n\r\n    const decoded = jwtDecode(token);\r\n\r\n    // 根据角色跳转\r\n    if (decoded.role === 'admin') {\r\n      await router.push('/adminpage/adminlist');\r\n    } else if (decoded.role === 'client') {\r\n      await router.push(`/edit/${decoded.id}`);\r\n    } else {\r\n      throw new Error('No permission');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error submitting form', error.response || error);\r\n    // 使用Vue的通知系统显示错误，而不是alert\r\n  } finally {\r\n    isLoading.value = false; // 登录结束，隐藏加载状态\r\n  }\r\n};\r\n\r\nconst callback = async (googleResponse) => {\r\n  isLoading.value = true; // 显示加载状态\r\n  try {\r\n    const response = await axios.post('http://localhost:8000/google', googleResponse);\r\n    const { token } = response.data;\r\n    localStorage.setItem(\"token\", token);\r\n    const decoded = jwtDecode(token);\r\n    \r\n    // 根据角色跳转\r\n    if (decoded.role === 'admin') {\r\n      await router.push(\"/adminpage/adminlist\");\r\n    } else {\r\n      await router.push(`/edit/${decoded.id}`);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error with Google login', error);\r\n    // 使用Vue的通知系统显示错误\r\n  } finally {\r\n    isLoading.value = false; // 隐藏加载状态\r\n  }\r\n}\r\n</script>\r\n"],"mappings":";gCACEA,mBAAA,CAAqB,YAAjB,cAAY;;;;uBADlBC,mBAAA,CAAAC,SAAA,SACEC,UAAqB,EACrBC,YAAA,CAUSC,iBAAA;IATNC,KAAK,EAAEC,MAAA,CAAAC,SAAS;IACjBC,IAAI,EAAC,OAAO;IACX,WAAS,EAAE;MAAAC,IAAA;IAAA,CAAW;IACtB,aAAW,EAAE;MAAAA,IAAA;IAAA,CAAY;IAC1BC,YAAY,EAAC,KAAK;IACjBC,QAAM,EAAEL,MAAA,CAAAK,QAAQ;IAChBC,cAAY,EAAEC,IAAA,CAAAD;;IATnBE,OAAA,EAAAC,QAAA,CAWI,MAAuB,CAAvBC,mBAAA,oBAAuB,C;IAX3BC,CAAA;kDAaElB,mBAAA,CAEM,cADJI,YAAA,CAAmCe,sBAAA;IAArBC,QAAQ,EAAEb,MAAA,CAAAa;EAAQ,G","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}