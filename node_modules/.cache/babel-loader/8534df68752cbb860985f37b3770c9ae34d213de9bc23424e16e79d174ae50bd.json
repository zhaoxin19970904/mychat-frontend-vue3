{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport loginForm from '../components/loginForm.vue';\nimport AdminPage from '../components/AdminPage.vue';\nimport ClientList from '../components/ClientList.vue';\nimport AdminList from '../components/AdminList';\nimport { jwtDecode } from 'jwt-decode';\nconst routes = [{\n  path: '/',\n  name: 'Login',\n  component: loginForm\n}, {\n  path: '/adminpage',\n  name: 'AdminPage',\n  component: AdminPage,\n  meta: {\n    requiresAdmin: true\n  },\n  children: [{\n    path: 'adminlist',\n    component: AdminList\n  }, {\n    path: 'clientlist',\n    component: ClientList\n  }]\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  // 检查路由是否需要 admin 权限\n  if (to.matched.some(record => record.meta.requiresAdmin)) {\n    const token = localStorage.getItem('token');\n    // 如果没有 token，则重定向到登录页面\n    if (!token) {\n      return next('/');\n    }\n    try {\n      // 解码 token 来获取用户角色\n      const decoded = jwtDecode(token);\n      if (decoded.role === 'admin') {\n        next(); // 角色为 admin，允许访问\n      } else {\n        alert('No permission'); // 不是 admin，显示无权限信息\n        next(from.path); // 阻止访问并返回上一页\n      }\n    } catch (error) {\n      console.error('Token decoding failed:', error);\n      next('/'); // 解码失败，重定向到登录页面\n    }\n  } else {\n    next(); // 不需要 admin 权限的路由，直接允许访问\n  }\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","loginForm","AdminPage","ClientList","AdminList","jwtDecode","routes","path","name","component","meta","requiresAdmin","children","router","history","beforeEach","to","from","next","matched","some","record","token","localStorage","getItem","decoded","role","alert","error","console"],"sources":["C:/Users/bobxi/OneDrive/Desktop/Ecloud/tut8/my-vue-app/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\r\nimport loginForm from '../components/loginForm.vue'\r\nimport AdminPage from '../components/AdminPage.vue'\r\nimport ClientList from '../components/ClientList.vue'\r\nimport AdminList from '../components/AdminList'\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nconst routes = [\r\n  {\r\n    path: '/',\r\n    name: 'Login',\r\n    component: loginForm\r\n  },\r\n  {\r\n    path: '/adminpage',\r\n    name: 'AdminPage',\r\n    component: AdminPage,\r\n    meta: { requiresAdmin: true },\r\n    children: [\r\n        {\r\n          path: 'adminlist', \r\n          component: AdminList\r\n        },\r\n        {\r\n          path: 'clientlist',\r\n          component: ClientList\r\n        }\r\n    ]\r\n  },\r\n  \r\n]\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(),\r\n  routes\r\n})\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n    // 检查路由是否需要 admin 权限\r\n    if (to.matched.some(record => record.meta.requiresAdmin)) {\r\n      const token = localStorage.getItem('token');\r\n      // 如果没有 token，则重定向到登录页面\r\n      if (!token) {\r\n        return next('/');\r\n      }\r\n  \r\n      try {\r\n        // 解码 token 来获取用户角色\r\n        const decoded = jwtDecode(token);\r\n        if (decoded.role === 'admin') {\r\n          next(); // 角色为 admin，允许访问\r\n        } else {\r\n          alert('No permission'); // 不是 admin，显示无权限信息\r\n          next(from.path); // 阻止访问并返回上一页\r\n        }\r\n      } catch (error) {\r\n        console.error('Token decoding failed:', error);\r\n        next('/'); // 解码失败，重定向到登录页面\r\n      }\r\n    } else {\r\n      next(); // 不需要 admin 权限的路由，直接允许访问\r\n    }\r\n  });\r\n\r\nexport default router"],"mappings":"AAAA,SAASA,YAAY,EAAEC,gBAAgB,QAAQ,YAAY;AAC3D,OAAOC,SAAS,MAAM,6BAA6B;AACnD,OAAOC,SAAS,MAAM,6BAA6B;AACnD,OAAOC,UAAU,MAAM,8BAA8B;AACrD,OAAOC,SAAS,MAAM,yBAAyB;AAC/C,SAASC,SAAS,QAAQ,YAAY;AAEtC,MAAMC,MAAM,GAAG,CACb;EACEC,IAAI,EAAE,GAAG;EACTC,IAAI,EAAE,OAAO;EACbC,SAAS,EAAER;AACb,CAAC,EACD;EACEM,IAAI,EAAE,YAAY;EAClBC,IAAI,EAAE,WAAW;EACjBC,SAAS,EAAEP,SAAS;EACpBQ,IAAI,EAAE;IAAEC,aAAa,EAAE;EAAK,CAAC;EAC7BC,QAAQ,EAAE,CACN;IACEL,IAAI,EAAE,WAAW;IACjBE,SAAS,EAAEL;EACb,CAAC,EACD;IACEG,IAAI,EAAE,YAAY;IAClBE,SAAS,EAAEN;EACb,CAAC;AAEP,CAAC,CAEF;AAED,MAAMU,MAAM,GAAGd,YAAY,CAAC;EAC1Be,OAAO,EAAEd,gBAAgB,CAAC,CAAC;EAC3BM;AACF,CAAC,CAAC;AAEFO,MAAM,CAACE,UAAU,CAAC,CAACC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAClC;EACA,IAAIF,EAAE,CAACG,OAAO,CAACC,IAAI,CAACC,MAAM,IAAIA,MAAM,CAACX,IAAI,CAACC,aAAa,CAAC,EAAE;IACxD,MAAMW,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C;IACA,IAAI,CAACF,KAAK,EAAE;MACV,OAAOJ,IAAI,CAAC,GAAG,CAAC;IAClB;IAEA,IAAI;MACF;MACA,MAAMO,OAAO,GAAGpB,SAAS,CAACiB,KAAK,CAAC;MAChC,IAAIG,OAAO,CAACC,IAAI,KAAK,OAAO,EAAE;QAC5BR,IAAI,CAAC,CAAC,CAAC,CAAC;MACV,CAAC,MAAM;QACLS,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC;QACxBT,IAAI,CAACD,IAAI,CAACV,IAAI,CAAC,CAAC,CAAC;MACnB;IACF,CAAC,CAAC,OAAOqB,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9CV,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;IACb;EACF,CAAC,MAAM;IACLA,IAAI,CAAC,CAAC,CAAC,CAAC;EACV;AACF,CAAC,CAAC;AAEJ,eAAeL,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}