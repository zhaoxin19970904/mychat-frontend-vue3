{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { reactive, ref } from 'vue';\nimport axios from 'axios';\nimport { useRouter } from 'vue-router';\nimport { jwtDecode } from 'jwt-decode';\nexport default {\n  __name: 'loginForm',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const formState = reactive({\n      username: '',\n      password: '',\n      remember: true\n    });\n    const isLoading = ref(false); // 新增：加载状态\n\n    const onFinish = async values => {\n      isLoading.value = true; // 登录开始，显示加载状态\n      try {\n        const response = await axios.post('http://localhost:8000/submit', values);\n        const token = response.data.token;\n        console.log(token);\n        localStorage.setItem('token', token);\n        const decoded = jwtDecode(token);\n\n        // 根据角色跳转\n        if (decoded.role === 'admin') {\n          await router.push('/adminpage/adminlist');\n        } else if (decoded.role === 'client') {\n          await router.push(`/edit/${decoded.id}`);\n        } else {\n          throw new Error('No permission');\n        }\n      } catch (error) {\n        console.error('Error submitting form', error.response || error);\n        // 使用Vue的通知系统显示错误，而不是alert\n      } finally {\n        isLoading.value = false; // 登录结束，隐藏加载状态\n      }\n    };\n    const callback = async googleResponse => {\n      isLoading.value = true; // 显示加载状态\n      try {\n        const response = await axios.post('http://localhost:8000/google', googleResponse);\n        const {\n          token\n        } = response.data;\n        localStorage.setItem(\"token\", token);\n        const decoded = jwtDecode(token);\n\n        // 根据角色跳转\n        if (decoded.role === 'admin') {\n          await router.push(\"/adminpage/adminlist\");\n        } else {\n          await router.push(`/edit/${decoded.id}`);\n        }\n      } catch (error) {\n        console.error('Error with Google login', error);\n        // 使用Vue的通知系统显示错误\n      } finally {\n        isLoading.value = false; // 隐藏加载状态\n      }\n    };\n    const __returned__ = {\n      router,\n      formState,\n      isLoading,\n      onFinish,\n      callback,\n      reactive,\n      ref,\n      get axios() {\n        return axios;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get jwtDecode() {\n        return jwtDecode;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["reactive","ref","axios","useRouter","jwtDecode","router","formState","username","password","remember","isLoading","onFinish","values","value","response","post","token","data","console","log","localStorage","setItem","decoded","role","push","id","Error","error","callback","googleResponse"],"sources":["C:/Users/bobxi/OneDrive/Desktop/Ecloud/tut8/my-vue-app/src/components/loginForm.vue"],"sourcesContent":["<template>\r\n  <h1>Welcome Chat</h1>\r\n  <a-form\r\n    :model=\"formState\"\r\n    name=\"basic\"\r\n    :label-col=\"{ span: 8 }\"\r\n    :wrapper-col=\"{ span: 16 }\"\r\n    autocomplete=\"off\"\r\n    @finish=\"onFinish\"\r\n    @finishFailed=\"onFinishFailed\"\r\n  >\r\n    <!-- 输入表单项省略，与原代码相同 -->\r\n  </a-form>\r\n  <div>\r\n    <GoogleLogin :callback=\"callback\"/>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref } from 'vue';\r\nimport axios from 'axios';\r\nimport { useRouter } from 'vue-router';\r\nimport {jwtDecode} from 'jwt-decode';\r\n\r\nconst router = useRouter();\r\nconst formState = reactive({\r\n  username: '',\r\n  password: '',\r\n  remember: true,\r\n});\r\nconst isLoading = ref(false); // 新增：加载状态\r\n\r\nconst onFinish = async values => {\r\n  isLoading.value = true; // 登录开始，显示加载状态\r\n  try {\r\n    const response = await axios.post('http://localhost:8000/submit', values);\r\n    const token = response.data.token;\r\n    console.log(token);\r\n    localStorage.setItem('token', token);\r\n\r\n    const decoded = jwtDecode(token);\r\n\r\n    // 根据角色跳转\r\n    if (decoded.role === 'admin') {\r\n      await router.push('/adminpage/adminlist');\r\n    } else if (decoded.role === 'client') {\r\n      await router.push(`/edit/${decoded.id}`);\r\n    } else {\r\n      throw new Error('No permission');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error submitting form', error.response || error);\r\n    // 使用Vue的通知系统显示错误，而不是alert\r\n  } finally {\r\n    isLoading.value = false; // 登录结束，隐藏加载状态\r\n  }\r\n};\r\n\r\nconst callback = async (googleResponse) => {\r\n  isLoading.value = true; // 显示加载状态\r\n  try {\r\n    const response = await axios.post('http://localhost:8000/google', googleResponse);\r\n    const { token } = response.data;\r\n    localStorage.setItem(\"token\", token);\r\n    const decoded = jwtDecode(token);\r\n    \r\n    // 根据角色跳转\r\n    if (decoded.role === 'admin') {\r\n      await router.push(\"/adminpage/adminlist\");\r\n    } else {\r\n      await router.push(`/edit/${decoded.id}`);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error with Google login', error);\r\n    // 使用Vue的通知系统显示错误\r\n  } finally {\r\n    isLoading.value = false; // 隐藏加载状态\r\n  }\r\n}\r\n</script>\r\n"],"mappings":";AAmBA,SAASA,QAAQ,EAAEC,GAAG,QAAQ,KAAK;AACnC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,SAAS,QAAQ,YAAY;AACtC,SAAQC,SAAS,QAAO,YAAY;;;;;;;IAEpC,MAAMC,MAAM,GAAGF,SAAS,CAAC,CAAC;IAC1B,MAAMG,SAAS,GAAGN,QAAQ,CAAC;MACzBO,QAAQ,EAAE,EAAE;MACZC,QAAQ,EAAE,EAAE;MACZC,QAAQ,EAAE;IACZ,CAAC,CAAC;IACF,MAAMC,SAAS,GAAGT,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;;IAE9B,MAAMU,QAAQ,GAAG,MAAMC,MAAM,IAAI;MAC/BF,SAAS,CAACG,KAAK,GAAG,IAAI,CAAC,CAAC;MACxB,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMZ,KAAK,CAACa,IAAI,CAAC,8BAA8B,EAAEH,MAAM,CAAC;QACzE,MAAMI,KAAK,GAAGF,QAAQ,CAACG,IAAI,CAACD,KAAK;QACjCE,OAAO,CAACC,GAAG,CAACH,KAAK,CAAC;QAClBI,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEL,KAAK,CAAC;QAEpC,MAAMM,OAAO,GAAGlB,SAAS,CAACY,KAAK,CAAC;;QAEhC;QACA,IAAIM,OAAO,CAACC,IAAI,KAAK,OAAO,EAAE;UAC5B,MAAMlB,MAAM,CAACmB,IAAI,CAAC,sBAAsB,CAAC;QAC3C,CAAC,MAAM,IAAIF,OAAO,CAACC,IAAI,KAAK,QAAQ,EAAE;UACpC,MAAMlB,MAAM,CAACmB,IAAI,CAAE,SAAQF,OAAO,CAACG,EAAG,EAAC,CAAC;QAC1C,CAAC,MAAM;UACL,MAAM,IAAIC,KAAK,CAAC,eAAe,CAAC;QAClC;MACF,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdT,OAAO,CAACS,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAACb,QAAQ,IAAIa,KAAK,CAAC;QAC/D;MACF,CAAC,SAAS;QACRjB,SAAS,CAACG,KAAK,GAAG,KAAK,CAAC,CAAC;MAC3B;IACF,CAAC;IAED,MAAMe,QAAQ,GAAG,MAAOC,cAAc,IAAK;MACzCnB,SAAS,CAACG,KAAK,GAAG,IAAI,CAAC,CAAC;MACxB,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMZ,KAAK,CAACa,IAAI,CAAC,8BAA8B,EAAEc,cAAc,CAAC;QACjF,MAAM;UAAEb;QAAM,CAAC,GAAGF,QAAQ,CAACG,IAAI;QAC/BG,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEL,KAAK,CAAC;QACpC,MAAMM,OAAO,GAAGlB,SAAS,CAACY,KAAK,CAAC;;QAEhC;QACA,IAAIM,OAAO,CAACC,IAAI,KAAK,OAAO,EAAE;UAC5B,MAAMlB,MAAM,CAACmB,IAAI,CAAC,sBAAsB,CAAC;QAC3C,CAAC,MAAM;UACL,MAAMnB,MAAM,CAACmB,IAAI,CAAE,SAAQF,OAAO,CAACG,EAAG,EAAC,CAAC;QAC1C;MACF,CAAC,CAAC,OAAOE,KAAK,EAAE;QACdT,OAAO,CAACS,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;QAC/C;MACF,CAAC,SAAS;QACRjB,SAAS,CAACG,KAAK,GAAG,KAAK,CAAC,CAAC;MAC3B;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}