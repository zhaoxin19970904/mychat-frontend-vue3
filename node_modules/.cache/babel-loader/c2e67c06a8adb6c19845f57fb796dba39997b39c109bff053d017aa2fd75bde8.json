{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { reactive } from 'vue';\nimport axios from 'axios';\nimport { useRouter } from 'vue-router';\nimport { jwtDecode } from 'jwt-decode';\nexport default {\n  __name: 'loginForm',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const formState = reactive({\n      username: '',\n      password: '',\n      remember: true\n    });\n    const onFinish = async values => {\n      try {\n        const response = await axios.post('http://localhost:8000/submit', values);\n        const token = response.data.token;\n        console.log(token);\n        localStorage.setItem('token', token);\n        const decoded = jwtDecode(token);\n        if (decoded.role === 'admin') {\n          router.push('/adminpage/adminlist');\n        } else if (decoded.role === 'client') {\n          router.push(`/edit/${decoded.id}`);\n        } else {\n          alert('No permission');\n          history.go(-1);\n        }\n      } catch (error) {\n        console.error('Error submitting form', error.response || error);\n        alert('Login failed');\n      }\n    };\n    const handleGoogleLogin = () => {\n      const clientId = \"892749453222-ckthm4h2leeonk0fvh8e7sefuau11i75.apps.googleusercontent.com\";\n      const redirectUri = encodeURIComponent(\"YOUR_REDIRECT_URI\");\n      const responseType = \"code\";\n      const scope = encodeURIComponent(\"email profile\");\n      const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=${scope}&prompt=select_account`;\n      window.location.href = authUrl;\n      window.google.accounts.id.prompt(notification => {\n        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {\n          // 提示框未显示或被跳过，根据需要处理\n          console.log(\"Google login prompt was not displayed or was skipped.\");\n        }\n      });\n    };\n    const handleCredentialResponse = async email => {\n      console.log(email);\n      try {\n        const response = await axios.post('http://localhost:8000/google', email);\n        const {\n          token\n        } = response.data;\n        localStorage.setItem(\"token\", token);\n        let decoded2 = jwtDecode(token);\n        console.log(decoded2.role);\n        if (decoded2.role === 'admin') {\n          router.push(\"/adminpage/adminlist\");\n        } else {\n          router.push(`/edit/${decoded2.id}\"`);\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    };\n\n    // Methods\n\n    const __returned__ = {\n      router,\n      formState,\n      onFinish,\n      handleGoogleLogin,\n      handleCredentialResponse,\n      reactive,\n      get axios() {\n        return axios;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get jwtDecode() {\n        return jwtDecode;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["reactive","axios","useRouter","jwtDecode","router","formState","username","password","remember","onFinish","values","response","post","token","data","console","log","localStorage","setItem","decoded","role","push","id","alert","history","go","error","handleGoogleLogin","clientId","redirectUri","encodeURIComponent","responseType","scope","authUrl","window","location","href","google","accounts","prompt","notification","isNotDisplayed","isSkippedMoment","handleCredentialResponse","email","decoded2","err"],"sources":["C:/Users/bobxi/OneDrive/Desktop/Ecloud/tut8/my-vue-app/src/components/loginForm.vue"],"sourcesContent":["<template>\r\n  <h1>Welcome Chat</h1>\r\n  <a-form\r\n    :model=\"formState\"\r\n    name=\"basic\"\r\n    :label-col=\"{ span: 8 }\"\r\n    :wrapper-col=\"{ span: 16 }\"\r\n    autocomplete=\"off\"\r\n    @finish=\"onFinish\"\r\n    @finishFailed=\"onFinishFailed\"\r\n  >\r\n    <a-form-item\r\n      label=\"Username\"\r\n      name=\"username\"\r\n      :rules=\"[{ required: true, message: 'Please input your username!' }]\"\r\n    >\r\n      <a-input v-model:value=\"formState.username\" />\r\n    </a-form-item>\r\n\r\n    <a-form-item\r\n      label=\"Password\"\r\n      name=\"password\"\r\n      :rules=\"[{ required: true, message: 'Please input your password!' }]\"\r\n    >\r\n      <a-input-password v-model:value=\"formState.password\" />\r\n    </a-form-item>\r\n\r\n    <a-form-item name=\"remember\" :wrapper-col=\"{ offset: 8, span: 16 }\">\r\n      <a-checkbox v-model:checked=\"formState.remember\">Remember me</a-checkbox>\r\n    </a-form-item>\r\n\r\n    <a-form-item :wrapper-col=\"{ offset: 8, span: 16 }\">\r\n      <a-button type=\"primary\" html-type=\"submit\">Submit</a-button>\r\n    </a-form-item>\r\n  </a-form>\r\n  <div>\r\n    <button @click=\"handleGoogleLogin\">Login with Google</button>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { reactive } from 'vue';\r\nimport axios from 'axios';\r\nimport { useRouter } from 'vue-router';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\n\r\n\r\nconst router = useRouter();\r\nconst formState = reactive({\r\n  username: '',\r\n  password: '',\r\n  remember: true,\r\n});\r\nconst onFinish = async values => {\r\n  try {\r\n    const response = await axios.post('http://localhost:8000/submit', values);\r\n    const token = response.data.token; \r\n    console.log(token)\r\n    localStorage.setItem('token', token); \r\n\r\n    const decoded = jwtDecode(token); \r\n    \r\n    if (decoded.role === 'admin') {\r\n      router.push('/adminpage/adminlist');\r\n    }\r\n    else if(decoded.role ==='client'){\r\n      router.push(`/edit/${decoded.id}`);\r\n    } else {\r\n      alert('No permission');\r\n      history.go(-1); \r\n    }\r\n  } catch (error) {\r\n    console.error('Error submitting form', error.response || error);\r\n    alert('Login failed');\r\n  }\r\n};\r\nconst handleGoogleLogin = () => {\r\n  const clientId = \"892749453222-ckthm4h2leeonk0fvh8e7sefuau11i75.apps.googleusercontent.com\";\r\n  const redirectUri = encodeURIComponent(\"YOUR_REDIRECT_URI\");\r\n  const responseType = \"code\";\r\n  const scope = encodeURIComponent(\"email profile\");\r\n  const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=${scope}&prompt=select_account`;\r\n\r\n  window.location.href = authUrl;\r\n\r\n\r\n\r\n  window.google.accounts.id.prompt((notification) => {\r\n    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {\r\n      // 提示框未显示或被跳过，根据需要处理\r\n      console.log(\"Google login prompt was not displayed or was skipped.\");\r\n    }\r\n  });\r\n};\r\n\r\nconst handleCredentialResponse = async email => {\r\n  console.log(email)\r\n  try{\r\n    const response = await axios.post('http://localhost:8000/google', email)\r\n    const { token } = response.data;\r\n    localStorage.setItem(\"token\",token);\r\n    let decoded2 = jwtDecode(token);\r\n    console.log(decoded2.role)\r\n    if(decoded2.role==='admin'){\r\n      router.push(\"/adminpage/adminlist\");\r\n    }\r\n    else{\r\n      router.push(`/edit/${decoded2.id}\"`)\r\n    }\r\n    \r\n  } catch (err){\r\n    console.log(err)\r\n  }\r\n\r\n};\r\n\r\n\r\n\r\n\r\n// Methods\r\n\r\n\r\n</script>\r\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}